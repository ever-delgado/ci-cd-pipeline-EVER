name: Notifications

on:
  workflow_run:
    workflows: ["CI Pipeline", "Deploy Pipeline"]
    types:
      - completed

jobs:
  notify-success:
    name: Notify Success
    runs-on: ubuntu-latest
    if: github.event.workflow_run.conclusion == 'success'
    
    steps:
    - name: Create Success Issue
      uses: actions/github-script@v7
      with:
        script: |
          const title = `‚úÖ Pipeline Exitoso - ${context.payload.workflow_run.name}`;
          const body = `
          ## ‚úÖ Pipeline Completado Exitosamente
          
          **Workflow:** ${context.payload.workflow_run.name}
          **Commit:** ${context.payload.workflow_run.head_sha}
          **Rama:** ${context.payload.workflow_run.head_branch}
          **Fecha:** ${new Date().toISOString()}
          **URL:** ${context.payload.workflow_run.html_url}
          
          ### ‚ÑπÔ∏è Detalles
          - ‚úÖ Todos los tests pasaron
          - ‚úÖ Build completado sin errores
          - ‚úÖ Deployment exitoso
          
          ---
          *Esta issue fue creada autom√°ticamente por GitHub Actions*
          `;
          
          github.rest.issues.create({
            owner: context.repo.owner,
            repo: context.repo.repo,
            title: title,
            body: body,
            labels: ['automated', 'success', 'pipeline']
          });

  notify-failure:
    name: Notify Failure
    runs-on: ubuntu-latest
    if: github.event.workflow_run.conclusion == 'failure'
    
    steps:
    - name: Create Failure Issue
      uses: actions/github-script@v7
      with:
        script: |
          const title = `‚ùå Pipeline Fallido - ${context.payload.workflow_run.name}`;
          const body = `
          ## ‚ùå Pipeline Fall√≥
          
          **Workflow:** ${context.payload.workflow_run.name}
          **Commit:** ${context.payload.workflow_run.head_sha}
          **Rama:** ${context.payload.workflow_run.head_branch}
          **Fecha:** ${new Date().toISOString()}
          **URL:** ${context.payload.workflow_run.html_url}
          
          ### üîç Acciones Requeridas
          1. Revisar los logs del pipeline fallido
          2. Verificar que todos los tests pasen localmente
          3. Corregir los errores encontrados
          4. Hacer push con las correcciones
          
          ### üìã Checklist de Debugging
          - [ ] Tests unitarios pasan
          - [ ] Tests de integraci√≥n pasan
          - [ ] No hay vulnerabilidades de seguridad
          - [ ] Build se completa sin errores
          
          ---
          *Esta issue fue creada autom√°ticamente por GitHub Actions*
          `;
          
          github.rest.issues.create({
            owner: context.repo.owner,
            repo: context.repo.repo,
            title: title,
            body: body,
            labels: ['automated', 'bug', 'pipeline-failure', 'urgent']
          });